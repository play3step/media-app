<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Media App</title>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="../styles/record.css">

</head>

<body>
    <div id="wrap">
        <div id="background_img">
            <div id ="record_cover">
                <div id = "tone_arm"></div>
                
            </div>
            <div id ="albume_info">
                <img id = "current_img">
            </div>  
            <div id="controller_box">
                <div id="music_controller">
                    <button id="btn_prev">
                        <img src="../png/skip_previous.png">
                    </button>
                    <button id="btn_play">
                        <img src="../png/play_arrow.png">
                    </button>
                    <button id="btn_next">
                        <img src="../png/skip_next.png">
                    </button>
                </div>
            </div>
        </div>
    </div>

</body>
<script type="module">
    // 재생 목록 데이터
    import { musicData } from "../data/data.js"
    console.log(musicData)

    // 현재 재생중인 오디오
    let currentAudio = new Audio()
    let image = musicData[0].image
    let title = musicData[0].title
    let author = musicData[0].author

    $("#current_img").attr('src',image)
    // 리스트에 추가
    for (let i in audios) {
        // 오디오 정보 변수
        let audio = new Audio(audios[i].audio)
        let image = audios[i].image
        let title = audios[i].title
        let author = audios[i].author

        let dom = $('<div></div>')
        dom.append('<p>' + author + ' - ' + title + '</p>')
        dom.append('<img src="' + image + '" width="100px">')
        dom.append(audio)

        // DOM 클릭 이벤트
        dom.click(function () {
            currentAudio.pause()
            currentAudio = audio
            currentAudio.currentTime = 0;
            currentAudio.play()

            $(this).siblings().removeClass('playing')
            $(this).addClass('playing')

            $('#current_image').attr('src', image);
            $('#current_title').text(author + ' - ' + title)
        })

        $('#play_list').append(dom)
    }

    // 현재 재생 기본 값 (0번 곡 자동으로 지정)
    $('#play_list > div').eq(0).click();
    currentAudio.pause()

    // 현재 시간 얻기
    setInterval(function () {
        $('#current_progress').text(currentAudio.currentTime + '/' + currentAudio.duration);

        let barWidth = $('#current_bar').innerWidth();
        $('#current_bar > div').css('width', barWidth * currentAudio.currentTime / currentAudio.duration)
    }, 50)

    // 버튼 이벤트
    $('#btn_play').click(function () { // 재생/일시정지
        if (currentAudio.paused == true) {
            currentAudio.play()
        }
        else {
            currentAudio.pause()
        }
    })

    $('#btn_stop').click(function () { // 완전 정지
        currentAudio.pause()
        currentAudio.currentTime = 0
    })
    $(document).ready(function () {
        $("#tone_arm").click(function () {
            $(this).css({'transform':'rotateZ(45deg)'});
            event.stopPropagation();
        });
    }); 

    $('#record_cover').click(function(){
            $(this).css({'transform':'rotateX(180deg)'})
    })

    $('#btn_prev').click(function () { // 이전곡
        let index = $(currentAudio).parent().index()
        $('#list > div').eq((index - 1) % audios.length).click()
    })

    $('#btn_next').click(function () { // 다음곡
        let index = $(currentAudio).parent().index()
        $('#list > div').eq((index + 1) % audios.length).click()
    })

    $('#btn_p10').click(function () { // 10초 후
        currentAudio.currentTime += 10
    })

    $('#btn_m10').click(function () { // 10초 전
        currentAudio.currentTime -= 10
    })


</script>

</html>